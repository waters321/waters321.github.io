<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="posts/4a17b156.html"/>
      <url>posts/4a17b156.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>maven无报错，idea编译报错</title>
      <link href="posts/b0d94d5b.html"/>
      <url>posts/b0d94d5b.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/chengjinsheng/p/13520787.html">https://www.cnblogs.com/chengjinsheng/p/13520787.html</a><br>​</p><p>​</p><p>find ./ -name “*.iml”| xargs rm -f<br>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>git clone <a href="https://github.com/BINGOcoder1998/dummy-lifecycle-mapping-plugin.git">https://github.com/BINGOcoder1998/dummy-lifecycle-mapping-plugin.git</a><br>mvn clean install<br>​</p><p>​</p><p>​</p><p>mvn idea:clean<br>mvn idea:project<br>mvn idea:module<br>mvn idea:workspace<br>​</p><p>​</p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1630895955693-2ac1cad8-dd6c-4fe4-b9b3-4c97afe0c13a.png#clientId=u20db6c23-ee7a-4&amp;from=paste&amp;height=370&amp;id=u0e9bbbd3&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=740&amp;originWidth=1240&amp;originalType=binary%E2%88%B6=1&amp;size=72379&amp;status=done&amp;style=none&amp;taskId=ucb4795b9-d50e-4832-b167-8375e069e72&amp;width=620" alt="image.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>非堆内存排查</title>
      <link href="posts/742dbe34.html"/>
      <url>posts/742dbe34.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/weixin_39878549/article/details/114788940">https://blog.csdn.net/weixin_39878549/article/details/114788940</a><br>​</p><p><a href="https://www.cnblogs.com/rude3knife/p/13570423.html">https://www.cnblogs.com/rude3knife/p/13570423.html</a><br>​</p><p><a href="https://blog.csdn.net/u010003835/article/details/52957904">https://blog.csdn.net/u010003835/article/details/52957904</a><br>​</p><p><a href="https://www.cnblogs.com/sxdcgaq8080/p/14958256.html">https://www.cnblogs.com/sxdcgaq8080/p/14958256.html</a><br>这个好一些<br><a href="https://www.javadoop.com/post/metaspace">https://www.javadoop.com/post/metaspace</a><br><a href="https://www.coder.work/article/6303057">https://www.coder.work/article/6303057</a><br>jamp -heap 1<br>​</p><p>​</p><p>xmx = 直接内存 +代码压缩空间+metaspace<br>​</p><p>​</p><p>-XX:MaxDirectMemorySize=2G<br>-XX:MetaspaceSize=250m -XX:MaxMetaspaceSize=250m<br>-Xms700m -Xmx700m<br>-XX:ReservedCodeCacheSize=200M<br><br>​</p><p>codecache + directMemory + maxMetaspace + xmx<br>240 1600 250 1600 bg-consumer 4000<br>240 700 250 700 web-admin 1400<br>240 450 200 450 web-api 1100<br>240 700 250 700 bg-task 1400<br>​</p><p>​</p><p>​</p><table><thead><tr><th>服务</th><th>codeCache</th><th>directMemory</th><th>xmx</th><th>maxMetaspace</th><th>求和</th><th>总分配</th></tr></thead><tbody><tr><td>bg-consumer</td><td>170M</td><td>1600M</td><td>1600M</td><td>250M</td><td>3620M</td><td>4000M</td></tr><tr><td>web-admin</td><td>170M</td><td>400M</td><td>600M</td><td>250M</td><td>1420M</td><td>1400M</td></tr><tr><td>web-api</td><td>140M</td><td>300M</td><td>450M</td><td>200M</td><td>1090M</td><td>1100M</td></tr></tbody></table><p>| bg-task<br>commit | 140M<br>100M | 400M<br>​<br>| 700M<br>700M | 250M<br>200M | 1490M<br>​<br>| 1400M |</p><p>​</p><p>​</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>awk</title>
      <link href="posts/c4a2fe4.html"/>
      <url>posts/c4a2fe4.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">zcat xx.production-s4.log-20210819.1.gz<span class="token operator">|</span><span class="token function">grep</span> -a <span class="token string">"V1.0 2021-08-19 11:1"</span><span class="token operator">|</span><span class="token function">grep</span> request<span class="token operator">|</span><span class="token function">grep</span> uri<span class="token operator">|</span><span class="token function">grep</span> method <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$5</span>}'</span> <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token string">']'</span> <span class="token string">'{count[<span class="token variable">$1</span>]++;} END {for(i in count) {print i count[i]}}'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>批量更新</title>
      <link href="posts/a6c9efb7.html"/>
      <url>posts/a6c9efb7.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-none"><code class="language-none">curl -XPOST udesk:xxxxxx@xxxxxx:9200/qw_cust_v1/qw_customer/_update_by_query -d '{    "query": {        "match": {            "companyId": 43        }    },    "script": {        "inline": "ctx._source.delete_flag = 1"    }}'curl -XPOST udesk:xxxxxxxx@xxxxxxxxx:9200/qw_cust_v1/qw_customer/_search -d '{    "query": {        "match": {            "companyId":43        }    }}'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>爬取公众号文章</title>
      <link href="posts/a1100fd9.html"/>
      <url>posts/a1100fd9.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/100327796">https://zhuanlan.zhihu.com/p/100327796</a><br><a href="https://blog.csdn.net/sunnyzyq/article/details/103837521">https://blog.csdn.net/sunnyzyq/article/details/103837521</a><br>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>按时间删除文件</title>
      <link href="posts/774371dc.html"/>
      <url>posts/774371dc.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token number">0</span> <span class="token number">5</span> * * * <span class="token function">find</span> /home/webuser/nacos/bin/logs -mindepth <span class="token number">1</span> -mtime +7 -exec <span class="token function">rm</span> -rf <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token function">find</span> /home/webuser/nacos/bin/logs -mindepth <span class="token number">1</span> -mtime +7 -exec <span class="token function">rm</span> -rf <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span class="token function">sudo</span> <span class="token function">find</span> /mnt/logs/log -mindepth <span class="token number">1</span> -type d -mtime +7 -exec <span class="token function">rm</span> -rf <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>重置offset</title>
      <link href="posts/f30b1af.html"/>
      <url>posts/f30b1af.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mqadmin consumerProgress -n <span class="token number">127.0</span>.0.1:9876 -g wf-group--group-calculate--production-s4-01mqadmin resetOffsetByTime -n <span class="token number">127.0</span>.0.1:9876 -g wf-group--group-calculate--production-s4-01 -t topic-wf-chat-order--production-s4-01 -s nowmqadmin consumerProgress -n <span class="token number">127.0</span>.0.1:9876 -g wf-group--single-calculate--production-s4-01mqadmin resetOffsetByTime -n <span class="token number">127.0</span>.0.1:9876 -g wf-group--single-calculate--production-s4-01 -t topic-wf-chat-order--production-s4-01 -s now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql8.0秒加列</title>
      <link href="posts/b4b9077c.html"/>
      <url>posts/b4b9077c.html</url>
      
        <content type="html"><![CDATA[<p>alter table wxwork_single_chat_record ADD COLUMN <code>voice_duration</code> bigint NULL DEFAULT NULL COMMENT ‘语音时长’, algorithm=instant;</p><p><a href="https://segmentfault.com/a/1190000024426474">https://segmentfault.com/a/1190000024426474</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>本机启动minio</title>
      <link href="posts/6ca59b8d.html"/>
      <url>posts/6ca59b8d.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_ACCESS_KEY</span><span class="token operator">=</span>admin<span class="token builtin class-name">export</span> <span class="token assign-left variable">MINIO_SECRET_KEY</span><span class="token operator">=</span>passwordminio server /Users/zhangmiao/Udesk/999_test/minio-data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql导入导出</title>
      <link href="posts/1534ee36.html"/>
      <url>posts/1534ee36.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">mysqldump -hlocalhost -P7777 -uxxxxx -p xx <span class="token operator">&gt;</span> xx.sqlmysql -hlocalhost -P7777 -uxxxx -p xx<span class="token builtin class-name">source</span> xxx.sqlmysqldump -hlocalhost -P3306 -uxxx -p xx xx xx  <span class="token operator">&gt;</span> xx.sqlmysqldump -h <span class="token number">192.168</span>.1.102 -uroot -proot  xxxxx <span class="token operator">&gt;</span> xxxx0410.sqlmysqldump -uroot -p123456 meteo sdata --where<span class="token operator">=</span><span class="token string">" sensorid=11 and fieldid=0"</span> <span class="token operator">&gt;</span> /home/czl/Temp.sqlmysqldump -hxxx -urw_xxx -pxxx -d xxxxx <span class="token operator">&gt;</span> xx.sqlmysqldump -hxxx -P3306 -urw_xxx -pxx -d xx <span class="token operator">&gt;</span> xx.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18   mysql修改密码允许访问</title>
      <link href="posts/d27e1d46.html"/>
      <url>posts/d27e1d46.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="token string">'password'</span><span class="token punctuation">;</span>grant all privileges on *.* to <span class="token string">'root'</span>@<span class="token string">'%'</span> identified by <span class="token string">'password'</span> with grant option<span class="token punctuation">;</span>grant all privileges on dbusmgr.* to <span class="token string">'dbusmgr'</span>@<span class="token string">'%'</span> identified by <span class="token string">'Dbusmgr!@#123'</span> with grant option<span class="token punctuation">;</span>grant all privileges on *.* to <span class="token string">'root'</span>@<span class="token string">'localhost'</span> identified by <span class="token string">'password'</span> with grant option<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>查看各表占用大小</title>
      <link href="posts/9607b735.html"/>
      <url>posts/9607b735.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> TABLE_NAME<span class="token punctuation">,</span>       <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data_length<span class="token operator">+</span>index_length<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'总GB'</span><span class="token punctuation">,</span>       <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>data_length<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'数据GB'</span><span class="token punctuation">,</span>       <span class="token function">round</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span>index_length<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">'索引GB'</span><span class="token punctuation">,</span>       TABLE_ROWS<span class="token punctuation">,</span>create_time<span class="token punctuation">,</span>update_time<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token keyword">WHERE</span> table_schema<span class="token operator">=</span><span class="token string">'xx'</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TABLE_NAME<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu mysql5.6的bug</title>
      <link href="posts/59c97425.html"/>
      <url>posts/59c97425.html</url>
      
        <content type="html"><![CDATA[<p>​</p><p>​</p><p>A security tool called AppArmor is denying access to a symlinked file (/etc/mysql/my.cnf.fallback).<br>Try this workaround, which will allow symlinks to be read by mysqld.<br>echo ‘/etc/mysql/** lr,’ &gt;&gt; /etc/apparmor.d/local/usr.sbin.mysqld<br>systemctl reload apparmor<br>Now mysqld should see your custom config.<br>This bug appears to be fixed in the MySQL 5.7 Ubuntu package.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>开启gtid</title>
      <link href="posts/7a4af53d.html"/>
      <url>posts/7a4af53d.html</url>
      
        <content type="html"><![CDATA[<p>gtid_mode = on<br>enforce_gtid_consistency = 1<br>log_slave_updates&nbsp;&nbsp;&nbsp;= 1</p><p>三个参数少一个就报错，启动不起来</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Apache Phoenix安装</title>
      <link href="posts/89ff6e5.html"/>
      <url>posts/89ff6e5.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">https://www.cnblogs.com/frankdeng/p/9536450.html<span class="token builtin class-name">export</span> <span class="token assign-left variable">PHOENIX_HOME</span><span class="token operator">=</span>/home/webuser/apache-phoenix-5.0.0-HBase-2.0-bin<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$PHOENIX_HOME</span>/binPhoenix+hbase的使用方法：登陆到测试服务器：<span class="token builtin class-name">cd</span> /home/webuser/apache-phoenix-5.0.0-HBase-2.0-bin/binsqlline.py localhost:2181基本操作方式：https://www.cnblogs.com/frankdeng/p/9536450.html  第三节：Phoenix基本命令sql语法和标准sql基本一致。https://phoenix.apache.org/language/index.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hbase安装</title>
      <link href="posts/c491b637.html"/>
      <url>posts/c491b637.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">https://hbase.apache.org/2.0/book.html<span class="token comment">#quickstart</span><span class="token builtin class-name">cd</span> /home/webuser/hbase-2.0.5<span class="token builtin class-name">cd</span> /home/webuser/hbase-2.0.5/conf<span class="token function">vim</span> hbase-site.xml<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase.rootdir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs://localhost:8020/hbase<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase.zookeeper.property.dataDir<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>/data/zookeeper<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>hbase.unsafe.stream.capability.enforce<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/value<span class="token operator">&gt;</span>    <span class="token operator">&lt;</span>description<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/description<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span><span class="token function">vim</span> hbase-env.sh<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/webuser/jdk1.8.0_141./bin/hbase shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hbase与hadoop的版本匹配</title>
      <link href="posts/7bff816c.html"/>
      <url>posts/7bff816c.html</url>
      
        <content type="html"><![CDATA[<p><a href="http://hbase.apache.org/book.html#basic.prerequisites">http://hbase.apache.org/book.html#basic.prerequisites</a></p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1625385397816-f49eb0dc-958d-44f0-b364-e119cc1e18b0.png#height=466&amp;id=k3rlf&amp;name=image.png&amp;originHeight=466&amp;originWidth=2122&amp;originalType=binary%E2%88%B6=1&amp;size=73661&amp;status=done&amp;style=none&amp;width=2122" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1625385398351-bcca31b2-42b3-4400-b559-e9eb01697b87.png#height=1456&amp;id=kPK9l&amp;name=image.png&amp;originHeight=1456&amp;originWidth=2034&amp;originalType=binary%E2%88%B6=1&amp;size=172427&amp;status=done&amp;style=none&amp;width=2034" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1625385398374-e4047cad-a3fc-407a-876c-d54844516cf4.png#height=1204&amp;id=c5YnC&amp;name=image.png&amp;originHeight=1204&amp;originWidth=1090&amp;originalType=binary%E2%88%B6=1&amp;size=169019&amp;status=done&amp;style=none&amp;width=1090" alt="image.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HDFS命令行操作命令</title>
      <link href="posts/236168f8.html"/>
      <url>posts/236168f8.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">hdfs versionhdfs dfs -ls /datahdfs dfs -mkdir /testhdfs dfs -touch /test/test.csvhdfs dfs -cat /data/test.csvhdfs dfs -put test.csv /test/hdfs dfs -get /test/test.csv <span class="token builtin class-name">.</span>hdfs dfs -put -f test.csv /test/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hadoop单机版</title>
      <link href="posts/ec9b3f7a.html"/>
      <url>posts/ec9b3f7a.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">rsync</span>/data/hadoop-3.1.2/etc/hadoopconf/core-site.xml:<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>fs.default.name<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>hdfs://localhost:900<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/value<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>conf/hdfs-site.xml:<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>dfs.replication<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/value<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>conf/mapred-site.xml:<span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>mapred.job.tracker<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span>         <span class="token operator">&lt;</span>value<span class="token operator">&gt;</span>localhost:900<span class="token operator"><span class="token file-descriptor important">1</span>&lt;</span>/value<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/configuration<span class="token operator">&gt;</span>在hadoop-env.sh中，再显示地重新声明一遍JAVA_HOME<span class="token function">vim</span> /home/webuser/hadoop-3.1.2/etc/hadoop/hadoop-env.sh<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/webuser/jdk1.8.0_141bin/hdfs namenode -formatsbin/start-dfs.shhttp://10.10.10.150:9870<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka常用命令</title>
      <link href="posts/fcfd194a.html"/>
      <url>posts/fcfd194a.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">动态修改topic日志保留时间kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name <span class="token function">users</span> --alter --add-config retention.ms<span class="token operator">=</span><span class="token number">864000000</span>/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 -topic km_im_session_log --alter --config retention.ms<span class="token operator">=</span><span class="token number">43200000</span>/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 -topic km_im_session_log --describesharding1_cc_conversationscc_conversationssharding1_customerscustomers/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-topics.sh --zookeeper localhost:2181 -topic customers --alter --config retention.ms<span class="token operator">=</span><span class="token number">54000000</span><span class="token function">du</span> -s * <span class="token operator">|</span><span class="token function">sort</span> -nr<span class="token operator">|</span><span class="token function">head</span>/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 -topic cs_shard2_replies --describe/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 -topic cs_shard2_replies --alter --config max.message.bytes<span class="token operator">=</span><span class="token number">2147483640</span>登陆进docker容器docker <span class="token builtin class-name">exec</span> -it kafka /bin/bash如果报错Error: JMX connector server communication error: service:jmx:rmi://64925191343a:1099则执行：unset JMX_PORT/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-topics.sh --zookeeper localhost:2181 --list<span class="token comment">## topic详细信息</span>kafka-topics.sh --zookeeper localhost:2181 --describe --topic staging-cs-proj<span class="token comment">## 控制台消费数据</span>kafka-console-consumer.sh --bootstrap-server kafka1:9092 --topic staging-cs-proj<span class="token comment">## 消费组列表</span>kafka-consumer-groups.sh --bootstrap-server kafka1:9092 --list<span class="token comment">## 消费组消费信息</span>kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper zoo1:2181 --group iss-inc-kafka-canal-group-gp --topic staging-cs-projkafka-run-class.sh kafka.tools.GetOffsetShell --broker-list kafka1:9092 --topic staging-cs-proj --time -1更改消费位点kafka-consumer-groups.sh --bootstrap-server kafka1:9092 --group iss-inc-kafka-canal-group-gp --topic dev-cs-proj --execute --reset-offsets --to-offset <span class="token number">1</span>kafka-consumer-groups.sh --bootstrap-server kafka1:9092 --group iss-inc-kafka-canal-group-gp --topic staging-cs-proj --execute --reset-offsets --to-offset <span class="token number">1</span>bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group test-group --reset-offsets --all-topics --to-datetime <span class="token number">2017</span>-08-04T14:30:00.000--kafka回拨到固定时间点（注意是国际时区）/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-im-group-gp --all-topics --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-base-group-gp --all-topics  --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-customer-group-gp --all-topics  --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-ticket-group-gp --all-topics  --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-cc-group-gp --all-topics  --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --group iss-inc-kafka-agent-notes-group-gp --all-topics  --execute --reset-offsets --to-datetime <span class="token number">2019</span>-06-03T04:00:00.000-- 查看消费点位置/home/webuser/kafka_2.12-2.3.1/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.5</span>.93.77:9092 --describe  --group is-increment-kafka-cs-shard1-group-im --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-im-group-gp --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-customer-group-gp --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-ticket-group-gp --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-base-group-gp --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-agent-notes-group-gp --all-topicsiss-inc-kafka-base-group-gp-sharding1/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group iss-inc-kafka-base-group-gp-sharding1 --all-topics/home/webuser/kafka_2.12-0.11.0.0/bin/kafka-consumer-groups.sh --bootstrap-server <span class="token number">10.1</span>.251.140:9092 --describe  --group case-inc-kafka-data-data-group-gp --all-topics/home/webuser/kafka_2.12-2.3.1/bin/kafka-consumer-groups.sh --bootstrap-server staging-xx:9998 --describe  --group uba_consumer --all-topics/home/webuser/kafka_2.12-2.3.1/bin/kafka-consumer-groups.sh --bootstrap-server staging-xx:9998 --describe  --group uba_clickHouse_consumer --all-topics<span class="token number">2019</span>-05-17 <span class="token number">16</span>:26:42.469 <span class="token punctuation">[</span>pool-6-thread-2<span class="token punctuation">]</span> ERROR com.alibaba.otter.canal.kafka.CanalKafkaProducer - org.apache.kafka.common.errors.RecordTooLargeException: The request included a message larger than the max message size the server will accept.--更改kafka可接收到的消息长度默认1MB，针对单个topic进行配置/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 --alter --topic canal-hz-km-main --config max.message.bytes<span class="token operator">=</span><span class="token number">2147483640</span>/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 -topic canal-hz-km-main --describe-- 查看topic列表/home/webuser/kafka_2.12-2.3.1/bin/kafka-topics.sh --zookeeper localhost:2181 --list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka换盘</title>
      <link href="posts/7ab1ffc.html"/>
      <url>posts/7ab1ffc.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">zookeeper-3.4.14/bin/zkServer.sh stopzookeeper-3.4.14/bin/zkServer.sh start<span class="token builtin class-name">cd</span> /home/webuser/kafka_2.12-2.3.1/binkafka-server-start.sh -daemon ~/kafka_2.12-2.3.1/config/server.propertieskafka-server-stop.sh<span class="token function">umount</span> /data/kafka<span class="token function">umount</span> /data/zookeeper<span class="token function">mount</span> /dev/vdb1 /data/kafka1<span class="token function">mount</span> /dev/vdc1 /data/zookeeper1<span class="token function">mkdir</span> -p /data/kafka1<span class="token function">mkdir</span> -p /data/zookeeper1<span class="token function">chown</span> -R webuser.webuser /data/kafka1<span class="token function">chown</span> -R webuser.webuser /data/zookeeper1<span class="token function">su</span> root<span class="token comment"># 挂载主盘</span><span class="token comment">## 查看是否有挂载盘，如果执行命令后，没有发现/dev/vdb，表示实例没有数据盘</span><span class="token function">fdisk</span> -l<span class="token comment">## 开始创建单分区数据盘</span><span class="token function">fdisk</span> /dev/vdbnp<span class="token number">1</span>回车回车wq<span class="token comment">## 查看新分区，是否有类似于/dev/vdb*的记录</span><span class="token function">fdisk</span> -l<span class="token comment">## 创建文件系统,数据仓库必须是xfs</span>mkfs.xfs /dev/vdd1<span class="token comment">## 备份 etc/fstab</span><span class="token function">vim</span> /etc/fstabblkid<span class="token comment">## 挂载</span><span class="token function">mkdir</span> -p /data/kafka<span class="token function">mount</span> /dev/vdd1 /data/kafka<span class="token comment">## 查看</span><span class="token function">df</span> -hT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka挂盘</title>
      <link href="posts/9af99972.html"/>
      <url>posts/9af99972.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">su</span> root<span class="token comment"># 挂载主盘</span><span class="token comment">## 查看是否有挂载盘，如果执行命令后，没有发现/dev/vdb，表示实例没有数据盘</span><span class="token function">fdisk</span> -l<span class="token comment">## 开始创建单分区数据盘</span><span class="token function">fdisk</span> /dev/vdbnp<span class="token number">1</span>回车回车wq<span class="token function">fdisk</span> /dev/vdcnp<span class="token number">1</span>回车回车wq<span class="token comment">## 查看新分区，是否有类似于/dev/vdb*的记录</span><span class="token function">fdisk</span> -l<span class="token comment">## 创建文件系统,数据仓库必须是xfs</span>mkfs.xfs /dev/vdb1mkfs.xfs /dev/vdc1<span class="token comment">## 备份 etc/fstab</span><span class="token function">cp</span> /etc/fstab /etc/fstab.bak<span class="token comment">## 写新分区信息</span><span class="token builtin class-name">echo</span> /dev/vdb1 /data/kafka xfs defaults <span class="token number">0</span> <span class="token number">0</span> <span class="token operator">&gt;&gt;</span> /etc/fstab<span class="token builtin class-name">echo</span> /dev/vdc1 /data/zookeeper xfs defaults <span class="token number">0</span> <span class="token number">0</span> <span class="token operator">&gt;&gt;</span> /etc/fstab<span class="token comment">## 挂载</span><span class="token function">mkdir</span> -p /data/kafka<span class="token function">mkdir</span> -p /data/zookeeper<span class="token function">mount</span> /dev/vdd1 /data/kafka<span class="token function">mount</span> /dev/vdc1 /data/zookeeper<span class="token comment">## 查看</span><span class="token function">df</span> -hT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka下盘</title>
      <link href="posts/fe9869b5.html"/>
      <url>posts/fe9869b5.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">zookeeper-3.4.14/bin/zkServer.sh stopzookeeper-3.4.14/bin/zkServer.sh start<span class="token builtin class-name">cd</span> /home/webuser/kafka_2.12-2.3.1/binkafka-server-start.sh -daemon ~/kafka_2.12-2.3.1/config/server.propertieskafka-server-stop.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka增加监控</title>
      <link href="posts/53ef5d24.html"/>
      <url>posts/53ef5d24.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> https://github.com/danielqsj/kafka_exporter/releases/download/v1.2.0/kafka_exporter-1.2.0.linux-amd64.tar.gz<span class="token function">tar</span> -zxvf kafka_exporter-1.2.0.linux-amd64.tar.gz<span class="token builtin class-name">cd</span> kafka_exporter-1.2.0.linux-amd64./kafka_exporter --kafka.server<span class="token operator">=</span>kafkaIP或者域名:9092 <span class="token operator">&amp;</span><span class="token function">vim</span> start.sh./kafka_exporter --kafka.server<span class="token operator">=</span><span class="token number">10.4</span>.92.92:9092 <span class="token operator">&amp;</span>- job_name: <span class="token string">'kafka'</span>     static_configs:      - targets: <span class="token punctuation">[</span><span class="token string">'10.1.251.140:9308'</span>,<span class="token string">'10.4.92.92:9308'</span><span class="token punctuation">]</span>        labels:          instance: insight-kafka<span class="token number">10.1</span>.251.140kafka-insight<span class="token number">10.1</span>.251.140:9308kafka-cem<span class="token number">10.4</span>.92.92:9308<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>kafka的内存</title>
      <link href="posts/3f36b16b.html"/>
      <url>posts/3f36b16b.html</url>
      
        <content type="html"><![CDATA[<p>Kafka 重度依赖底层操作系统提供的 PageCache 功能。当上层有写操作时，操作系统只是将数据写入 PageCache，同时标记 Page 属性为 Dirty。<br>当读操作发生时，先从 PageCache 中查找，如果发生缺页才进行磁盘调度，最终返回需要的数据。实际上 PageCache 是把尽可能多的空闲内存都当做了磁盘缓存来使用。同时如果有其他进程申请内存，回收 PageCache 的代价又很小，所以现代的 OS 都支持 PageCache。<br>使用 PageCache 功能同时可以避免在 JVM 内部缓存数据，JVM 为我们提供了强大的 GC 能力，同时也引入了一些问题不适用与 Kafka 的设计。</p><p>如果在 Heap 内管理缓存，JVM 的 GC 线程会频繁扫描 Heap 空间，带来不必要的开销。如果 Heap 过大，执行一次 Full GC 对系统的可用性来说将是极大的挑战。</p><p>所有在在 JVM 内的对象都不免带有一个 Object Overhead(千万不可小视)，内存的有效空间利用率会因此降低。</p><p>所有的 In-Process Cache 在 OS 中都有一份同样的 PageCache。所以通过将缓存只放在 PageCache，可以至少让可用缓存空间翻倍。</p><p>如果 Kafka 重启，所有的 In-Process Cache 都会失效，而 OS 管理的 PageCache 依然可以继续使用。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>修改编码问题</title>
      <link href="posts/bd5a1fc6.html"/>
      <url>posts/bd5a1fc6.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">SELECT CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE  '</span>, TABLE_NAME, <span class="token string">' ENGINE=InnoDB DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'</span><span class="token punctuation">)</span> executeSQLFROM information_schema.TABLES bWHERE <span class="token string">'utf8mb4_general_ci'</span> <span class="token operator">!=</span> b.TABLE_COLLATION  AND b.TABLE_SCHEMA <span class="token operator">=</span> <span class="token string">'xx'</span><span class="token punctuation">;</span>SELECT CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE '</span>, TABLE_SCHEMA,<span class="token string">'.'</span>,TABLE_NAME, <span class="token string">' MODIFY COLUMN <span class="token variable"><span class="token variable">`</span>',COLUMN_NAME,'<span class="token variable">`</span></span> '</span>,COLUMN_TYPE,<span class="token string">' CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'</span><span class="token punctuation">)</span> <span class="token string">'修正SQL'</span>FROM information_schema.<span class="token variable"><span class="token variable">`</span><span class="token environment constant">COLUMNS</span><span class="token variable">`</span></span>WHERE COLLATION_NAME RLIKE <span class="token string">'utf8mb4_0900_ai_ci'</span> and <span class="token assign-left variable">TABLE_SCHEMA</span><span class="token operator">=</span><span class="token string">'xx'</span><span class="token punctuation">;</span><span class="token keyword">select</span> CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE '</span>, TABLE_SCHEMA,<span class="token string">'.'</span>,TABLE_NAME, <span class="token string">' MODIFY COLUMN <span class="token variable"><span class="token variable">`</span>',COLUMN_NAME,'<span class="token variable">`</span></span> longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'</span><span class="token punctuation">)</span> <span class="token string">'修正SQL'</span>FROM information_schema.<span class="token variable"><span class="token variable">`</span><span class="token environment constant">COLUMNS</span><span class="token variable">`</span></span>WHERE  <span class="token assign-left variable">TABLE_SCHEMA</span><span class="token operator">=</span><span class="token string">'xx'</span> and data_type like <span class="token string">'%text%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>私有化集群部署</title>
      <link href="posts/5c9a624.html"/>
      <url>posts/5c9a624.html</url>
      
        <content type="html"><![CDATA[<p>端口占用情况：<br>8080 控制台监控<br>5557 exporter 监控</p><p>9876 namesrv<br>10909 VIP<br>10911 非 VIP<br>10912 HA 主从同步端口<br>​</p><p>​</p><p>规划：</p><p>xxxx rocketmq-master01<br>xxxx rocketmq-master02<br>xxxx rocketmq-slave01<br>xxxx rocketmq-slave02<br>​</p><p>sudo yum install java-1.8.0-openjdk.x86_64 -y<br>sudo yum install java-1.8.0-openjdk-devel.x86_64 -y</p><p>wget <a href="https://mirrors.tuna.tsinghua.edu.cn/">https://mirrors.tuna.tsinghua.edu.cn/</a>apache/<a href="https://apache.claz.org/rocketmq/4.8.0/rocketmq-all-4.8.0-bin-release.zip">rocketmq/4.8.0/rocketmq-all-4.8.0-bin-release.zip</a></p><p>cd /tmp<br>unzip rocketmq-all-4.8.0-bin-release.zip<br>mv rocketmq-all-4.8.0-bin-release ~</p><p>sudo vim /etc/hosts</p><p>xxxx rocketmq-master01<br>xxxx rocketmq-master02<br>xxxx rocketmq-slave01<br>xxxx rocketmq-slave02<br>​</p><p>​</p><p>​</p><p><a href="https://www.jianshu.com/p/22235f54724f">https://www.jianshu.com/p/22235f54724f</a><br><a href="https://github.com/apache/rocketmq/blob/master/docs/cn/acl/user_guide.md">https://github.com/apache/rocketmq/blob/master/docs/cn/acl/user_guide.md</a><br>​</p><p>​</p><p>​</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">vim</span> broker-a.properties<span class="token function">vim</span> broker-a-s.properties<span class="token function">vim</span> broker-b.properties<span class="token function">vim</span> broker-b-s.properties<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span>xxxx:9876<span class="token punctuation">;</span>xxxx:9876<span class="token punctuation">;</span>xxxx:9876<span class="token punctuation">;</span>xxxx:9876<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;&gt;</span> broker-a.properties<span class="token builtin class-name">echo</span> <span class="token string">'auto_create_topic_enable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b.properties<span class="token builtin class-name">echo</span> <span class="token string">'aclEnable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b.properties<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;&gt;</span> broker-a-s.properties<span class="token builtin class-name">echo</span> <span class="token string">'auto_create_topic_enable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b-s.properties<span class="token builtin class-name">echo</span> <span class="token string">'aclEnable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b-s.properties<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;&gt;</span> broker-b.properties<span class="token builtin class-name">echo</span> <span class="token string">'auto_create_topic_enable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b.properties<span class="token builtin class-name">echo</span> <span class="token string">'aclEnable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b.properties<span class="token builtin class-name">echo</span> <span class="token string">''</span> <span class="token operator">&gt;&gt;</span> broker-b-s.properties<span class="token builtin class-name">echo</span> <span class="token string">'auto_create_topic_enable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b-s.properties<span class="token builtin class-name">echo</span> <span class="token string">'aclEnable=true'</span> <span class="token operator">&gt;&gt;</span> broker-b-s.properties<span class="token function">vim</span> plain_acl.ymlglobalWhiteRemoteAddresses:accounts:- accessKey: xxxx  secretKey: xxxx  whiteRemoteAddress:  admin: <span class="token boolean">true</span><span class="token function">cp</span> plain_acl.yml /home/ylapp/store/config/<span class="token function">vim</span> tools.sh<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -server -Xms500m -Xmx500m -Xmn128m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=64m"</span><span class="token function">vim</span> runserver.sh<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -server -Xms1g -Xmx1g -Xmn500m -XX:MetaspaceSize=64m -XX:MaxMetaspaceSize=100m"</span><span class="token function">vim</span> runbroker.sh<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${JAVA_OPT}</span> -server -Xms1g -Xmx1g -Xmn512m"</span><span class="token comment">#JAVA_OPT="${JAVA_OPT} -XX:MaxDirectMemorySize=15g"</span><span class="token function">mkdir</span> -p /home/ylapp/logs/rocketmqlogs/<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&gt;</span> ~/logs/rocketmqlogs/mqnamesrv.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">tail</span> -n <span class="token number">100</span> ~/logs/rocketmqlogs/mqnamesrv.log<span class="token function">vim</span> start-mqnamesrv.sh<span class="token function">nohup</span> <span class="token function">sh</span> bin/mqnamesrv <span class="token operator">&gt;</span> ~/logs/rocketmqlogs/mqnamesrv.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">vim</span> start-broker.sh<span class="token function">sh</span> bin/mqbroker -c conf/2m-2s-async/broker-a.properties <span class="token operator">&gt;</span> /data/logs/rocketmqlogs/broker-a.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">vim</span> start-broker.sh<span class="token function">sh</span> bin/mqbroker -c conf/2m-2s-async/broker-b.properties <span class="token operator">&gt;</span> /data/logs/rocketmqlogs/broker-b.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">vim</span> start-broker.sh<span class="token function">sh</span> bin/mqbroker -c conf/2m-2s-async/broker-a-s.properties <span class="token operator">&gt;</span> /data/logs/rocketmqlogs/broker-a-s.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span><span class="token function">vim</span> start-broker.sh<span class="token function">sh</span> bin/mqbroker -c conf/2m-2s-async/broker-b-s.properties <span class="token operator">&gt;</span> /data/logs/rocketmqlogs/broker-b-s.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>控制台监控手册：https://github.com/apache/rocketmq-externals/tree/master/rocketmq-console修改配置<span class="token function">git</span> clone https://gitee.com/mirrors/RocketMQ-Externals.gitmvn clean package -Dmaven.test.skip<span class="token operator">=</span>truejava -jar -Xms100m -Xmx100m rocketmq-console-ng-2.0.0.jar<span class="token function">nohup</span> java -jar -Xms100m -Xmx100m rocketmq-console-ng-2.0.0.jar <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>rocketmq-exporterhttps://github.com/apache/rocketmq-exporter修改配置mvn package -Dmaven.test.skip<span class="token operator">=</span>truejava -jar -Xms300m -Xmx300m rocketmq-exporter-0.0.2-SNAPSHOT.jar<span class="token builtin class-name">cd</span> /home/ylapp/rocketmq-all-4.8.0-bin-release<span class="token builtin class-name">echo</span> <span class="token string">'bin/mqshutdown broker'</span> <span class="token operator">&gt;&gt;</span> stop-all.sh<span class="token builtin class-name">echo</span> <span class="token string">'bin/mqshutdown namesrv'</span> <span class="token operator">&gt;&gt;</span> stop-all.sh<span class="token function">cp</span> /usr/lib/jvm/jre-1.8.0-openjdk-1.8.0.292.b10-1.el7_9.x86_64/lib/ext/sunjce_provider.jar ~/rocketmq-all-4.8.0-bin-release/lib/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p><p>​</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MQ调整与介绍</title>
      <link href="posts/cc09b699.html"/>
      <url>posts/cc09b699.html</url>
      
        <content type="html"><![CDATA[<h1 id="1、先介绍下顺序消息和无序消息，有滥用的情况"><a href="#1、先介绍下顺序消息和无序消息，有滥用的情况" class="headerlink" title="1、先介绍下顺序消息和无序消息，有滥用的情况"></a>1、先介绍下顺序消息和无序消息，有滥用的情况</h1><h2 id="（1）什么情况下用有序消息？"><a href="#（1）什么情况下用有序消息？" class="headerlink" title="（1）什么情况下用有序消息？"></a>（1）什么情况下用有序消息？</h2><ul><li>按租户有序，执行必须有先后顺序的。</li></ul><p>例如：<br>企业微信的变更回调，修改员工信息，先改姓名，然后改性别，必须有序。<br>计算聊天记录，依赖上一条聊天记录的状态。</p><h2 id="（2）什么情况下用无序消息？"><a href="#（2）什么情况下用无序消息？" class="headerlink" title="（2）什么情况下用无序消息？"></a>（2）什么情况下用无序消息？</h2><ul><li>只是记录事件，先后无所谓。</li></ul><p>例如：<br>发通知。<br>生成动态。</p><h1 id="2、微丰-rocketmq-的重新梳理与规划"><a href="#2、微丰-rocketmq-的重新梳理与规划" class="headerlink" title="2、微丰 rocketmq 的重新梳理与规划"></a>2、微丰 rocketmq 的重新梳理与规划</h1><h2 id="（1）背景（为什么）"><a href="#（1）背景（为什么）" class="headerlink" title="（1）背景（为什么）"></a>（1）背景（为什么）</h2><ul><li>测试环境 common 冲突</li></ul><p>因为数据库共用一套<br>bg-consumer 的 topic 和 consumer 定义未区分环境，我们使用的 CLUSTERING 消费模式，如果每个环境都部署，那么变成了每个环境均分消息消费。哪个环境消费哪条消息完全不可控。<br>bg-task</p><ul><li>线程数量过多</li></ul><p>之前介绍了，1 个消费者会起 20 个线程。我们 50 个消费者，1000 个线程。按粗暴算法，启动需要内存就 1G 左右。降低消费者数量。</p><ul><li>兼容阿里云</li></ul><p>阿里云顺序消息和无序消息不能共用 1 个 topic，所以为了防止有客户私有化部署到阿里云，所以此次也做了。社区版是可以的。</p><ul><li>北斗消费告警</li></ul><p>这个跟告警机制有关。按 tag 的消费，计算的是 offset，并不是待消费的真实消息数量，告警阈值会不准确。</p><h2 id="（2）变更位置"><a href="#（2）变更位置" class="headerlink" title="（2）变更位置"></a>（2）变更位置</h2><ul><li>配置文件变更</li></ul><p>增加 topic<br>增加 consumer-group</p><ul><li>MqManager.java</li></ul><p>tag 需要告知发向哪个 topic<br>topic 调整</p><ul><li>按 TAG 合并</li></ul><p>UpAndDownWeworkMessageListener<br>AllConcurrentlyMessageListener</p><h2 id="（3）后续-TODO-优化，各种策略，优先级队列优化"><a href="#（3）后续-TODO-优化，各种策略，优先级队列优化" class="headerlink" title="（3）后续 TODO 优化，各种策略，优先级队列优化"></a>（3）后续 TODO 优化，各种策略，优先级队列优化</h2><ul><li>有些租户比较苛刻，不能有丝毫延迟，需要单独开 vip 队列，或者单独开慢速队列。</li><li>因为我们的发送消息都是统一入口，所以改这里就好了。MqManager.java</li></ul><p><em>​</em></p><h2 id="（4）测试环境以后如何进行使用？"><a href="#（4）测试环境以后如何进行使用？" class="headerlink" title="（4）测试环境以后如何进行使用？"></a>（4）测试环境以后如何进行使用？</h2><p>（1）现有在用后端分支需要 rebase develop<br>看下 jenkins<br>（2）测试环境 task 指向变更<br>看下 xxl-job<br>（3）本地调试 task 的手动调用<br><a href="https://xxxxx.com/task/test/run?jobName=WxWorkChatRecordJob&amp;params=xxxxx">https://xxxxx.com/task/test/run?jobName=WxWorkChatRecordJob&amp;params=xxxxx</a><br><a href="http://127.0.0.1:8012/test/run?jobName=WxWorkChatRecordJob&amp;params=xxxxx">http://127.0.0.1:8012/test/run?jobName=WxWorkChatRecordJob&amp;params=xxxxx</a><br>看下接口实现，postman</p><h2 id="（5）本地的-consumer-调试"><a href="#（5）本地的-consumer-调试" class="headerlink" title="（5）本地的 consumer 调试"></a>（5）本地的 consumer 调试</h2><p>（1）改配置文件内的<strong>wf-suffix</strong>，但是记得不要提交这个</p><h1 id="3、疑问？"><a href="#3、疑问？" class="headerlink" title="3、疑问？"></a>3、疑问？</h1><p><em>​</em></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>内存排查</title>
      <link href="posts/8ddd334f.html"/>
      <url>posts/8ddd334f.html</url>
      
        <content type="html"><![CDATA[<h1 id="Java-内存占用排查的方法"><a href="#Java-内存占用排查的方法" class="headerlink" title="Java 内存占用排查的方法"></a><a href="https://www.cnblogs.com/caibh/p/13785342.html">Java 内存占用排查的方法</a></h1><h2 id="htop：查进程的内存占用"><a href="#htop：查进程的内存占用" class="headerlink" title="htop：查进程的内存占用#"></a>htop：查进程的内存占用<a href="https://www.cnblogs.com/caibh/p/13785342.html#htop%EF%BC%9A%E6%9F%A5%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8">#</a></h2><pre class="line-numbers language-none"><code class="language-none">$ htop<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://gitee.com/caibaohong/img/raw/master/2020-10-09/1d9bac852ac0ca105de5710e1b51c69d-find-java-process-by-htop.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1623133031032-c04b443a-1df0-4c8f-854c-e461833ed9e7.png#height=170&amp;id=z2DyY&amp;originHeight=170&amp;originWidth=1008&amp;originalType=binary%E2%88%B6=1&amp;size=0&amp;status=done&amp;style=none&amp;width=1008"></a><br>相关名词:<br><strong>VIRT</strong>：<strong>virt</strong>ual memory usage <strong>虚拟内存</strong></p><ul><li>进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等</li><li>假如进程申请 100m 的内存，但实际只使用了 10m，那么它会增长 100m，而不是实际的使用量</li></ul><p><strong>RES</strong>：<strong>res</strong>ident memory usage <strong>常驻内存</strong></p><ul><li>进程当前使用的内存大小，但不包括 swap out</li><li>包含其他进程的共享</li><li>如果申请 100m 的内存，实际使用 10m，它只增长 10m，与 VIRT 相反</li><li>关于库占用内存的情况，它只统计加载的库文件所占内存大小</li></ul><p><strong>SHR</strong>：<strong>sh</strong>a<strong>r</strong>ed memory <strong>共享内存</strong></p><ul><li>除了自身进程的共享内存，也包括其他进程的共享内存</li><li>虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小</li><li>计算某个进程所占的物理内存大小公式：RES – SHR</li><li>swap out 后，它将会降下来</li></ul><h2 id="pmap：查进程的内存分布"><a href="#pmap：查进程的内存分布" class="headerlink" title="pmap：查进程的内存分布#"></a>pmap：查进程的内存分布<a href="https://www.cnblogs.com/caibh/p/13785342.html#pmap%EF%BC%9A%E6%9F%A5%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83">#</a></h2><p>先使用 htop 找到 java 进程的进程 id，然后：</p><pre class="line-numbers language-none"><code class="language-none">pmap -x 30420<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>上面的命令的输出结果没法进行排序找出较大的内存块，建议导出成文件，下载到自己本机分析。我自己的做法是在自己本机使用 IDEA 打开，然后利用多行编辑功能在每一列添加英文逗号<code>“,”</code>，因为这样能都对<code>RSS</code>（Resident Set Size）列排序，具体操作如下：</p><blockquote><p>RSS 是常驻内存集（Resident Set Size），表示该进程分配的内存大小</p></blockquote><p>导出：</p><pre class="line-numbers language-none"><code class="language-none"># 在服务器上导出pmap -x 30420 &gt; pmap30420.csv# 利用lszrz下载sz -be pmap30420.csv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>然后 vscode（不要用 IDEA，很卡。行数多的时候 vscode 没那么卡）打开，利用多行编辑（快捷键 alt + shift + up/down）加英文逗号：<br><a href="https://gitee.com/caibaohong/img/raw/master/2020-10-09/8e9566082a5402a602dc4eb6a8253a25-pmap-csv.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1623133030963-be346396-ab65-46f3-95b8-572bed4b874f.png#height=198&amp;id=u6Ii2&amp;originHeight=198&amp;originWidth=428&amp;originalType=binary%E2%88%B6=1&amp;size=0&amp;status=done&amp;style=none&amp;width=428"></a><br>然后就可以用 Excel 打开，对第三列<code>RSS</code>倒序排序找出可疑的（占用多的）是哪些内存块：<br><a href="https://gitee.com/caibaohong/img/raw/master/2020-10-09/f3011483e5c9661c1d39fdd86ab5dd43-pmap-excel.png"><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1623133030797-f3eb84e2-a1ca-4ef8-b3b9-e9db697df5b4.png#height=211&amp;id=TnS6y&amp;originHeight=211&amp;originWidth=467&amp;originalType=binary%E2%88%B6=1&amp;size=0&amp;status=done&amp;style=none&amp;width=467"></a></p><h2 id="NMT：查-JVM-内存"><a href="#NMT：查-JVM-内存" class="headerlink" title="NMT：查 JVM 内存#"></a>NMT：查 JVM 内存<a href="https://www.cnblogs.com/caibh/p/13785342.html#nmt%EF%BC%9A%E6%9F%A5jvm%E5%86%85%E5%AD%98">#</a></h2><p><strong>注意：</strong>NMT 是用来看 Java 进程中 JVM 部分的内存情况，并非整个 Java 进程的内存情况</p><pre class="line-numbers language-none"><code class="language-none">java -XX:NativeMemoryTracking=[detail|summary]# 例如：java -Xms500M -Xmx1500M -XX:NativeMemoryTracking=detail -jar ewulian-server.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后使用 jcmd</p><pre class="line-numbers language-none"><code class="language-none"># 加detail是看详情jcmd PID VM.native_memory [detail]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>例如：</p><pre class="line-numbers language-none"><code class="language-none">$ jcmd 30420 VM.native_memory &gt; jcmd30420-summary.txt$ cat jcmd30420-summary.txt30420:Native Memory Tracking:Total: reserved=3201582KB, committed=991846KB-                 Java Heap (reserved=1536000KB, committed=565760KB)                            (mmap: reserved=1536000KB, committed=565760KB)-                     Class (reserved=1141993KB, committed=104385KB)                            (classes #15022)                            (malloc=7401KB #29512)                            (mmap: reserved=1134592KB, committed=96984KB)-                    Thread (reserved=77490KB, committed=77490KB)                            (thread #76)                            (stack: reserved=77060KB, committed=77060KB)                            (malloc=246KB #381)                            (arena=184KB #147)-                      Code (reserved=260241KB, committed=61473KB)                            (malloc=10641KB #14504)                            (mmap: reserved=249600KB, committed=50832KB)-                        GC (reserved=61908KB, committed=58788KB)                            (malloc=5784KB #490)                            (mmap: reserved=56124KB, committed=53004KB)-                  Compiler (reserved=365KB, committed=365KB)                            (malloc=235KB #1216)                            (arena=131KB #6)-                  Internal (reserved=98440KB, committed=98440KB)                            (malloc=98408KB #21205)                            (mmap: reserved=32KB, committed=32KB)-                    Symbol (reserved=20667KB, committed=20667KB)                            (malloc=17590KB #178837)                            (arena=3077KB #1)-    Native Memory Tracking (reserved=4353KB, committed=4353KB)                            (malloc=412KB #5868)                            (tracking overhead=3942KB)-               Arena Chunk (reserved=125KB, committed=125KB)                            (malloc=125KB)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>jcmd 还有其它功能，比如查看 Java 进程的堆直方图</p></blockquote><h2 id="查看-java-进程的堆直方图"><a href="#查看-java-进程的堆直方图" class="headerlink" title="查看 java 进程的堆直方图#"></a>查看 java 进程的堆直方图<a href="https://www.cnblogs.com/caibh/p/13785342.html#%E6%9F%A5%E7%9C%8Bjava%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%A0%86%E7%9B%B4%E6%96%B9%E5%9B%BE">#</a></h2><pre class="line-numbers language-none"><code class="language-none">$ jcmd 30420 GC.class_histogram | less<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>说明：</p><ul><li><code>GC.class_histogram</code>：输出的仅包含活跃对象</li><li><code>[C</code>：字符数组</li><li><code>[B</code>：字节数组</li><li><code>[Ljava.lang.Object</code>：Object 数组<blockquote><p>jcmd 的其它功能可以通过 help 查看：</p></blockquote></li></ul><pre class="line-numbers language-none"><code class="language-none">$ jcmd 30420 help30420:The following commands are available:JFR.stopJFR.startJFR.dumpJFR.checkVM.native_memoryVM.check_commercial_featuresVM.unlock_commercial_featuresManagementAgent.stopManagementAgent.start_localManagementAgent.startVM.classloader_statsGC.rotate_logThread.printGC.class_statsGC.class_histogramGC.heap_dumpGC.finalizer_infoGC.heap_infoGC.run_finalizationGC.runVM.uptimeVM.dynlibsVM.flagsVM.system_propertiesVM.command_lineVM.versionhelp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>锁正由进程 （unattended-upgr）持有</title>
      <link href="posts/2f5b164e.html"/>
      <url>posts/2f5b164e.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> dpkg-reconfigure -plow unattended-upgrades  <span class="token comment">#禁用系统自动升级</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Arthas</title>
      <link href="posts/e1a71cf6.html"/>
      <url>posts/e1a71cf6.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> https://arthas.aliyun.com/arthas-boot.jar --no-check-certificatejava -jar arthas-boot.jar --repo-mirror aliyun --use-httpdashboardheapdump /tmp/dump_090802.hprof<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Metaspace 排查：<br><a href="https://www.jianshu.com/p/e95ea462703d">https://www.jianshu.com/p/e95ea462703d</a><br><a href="https://segmentfault.com/a/1190000023851152">https://segmentfault.com/a/1190000023851152</a><br>​</p><p><a href="https://www.jianshu.com/p/9f814df5252e">https://www.jianshu.com/p/9f814df5252e</a><br>-Dsun.reflect.inflationThreshold<br>​</p><p>​</p><p>​</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>关于顺序消息，无序消息的试验</title>
      <link href="posts/7eed3a68.html"/>
      <url>posts/7eed3a68.html</url>
      
        <content type="html"><![CDATA[<p>1、顺序消息和无序消息共用 1 个队列是什么样子的。（官网版是可以的）</p><p>自建 rocketmq，顺序消息和无需消息共用 1 个队列是没有问题的。<br>但是消费者，都是开启 20 个最小线程。<br>只不过，<br>顺序消费，活跃线程数=messageQueue 的数量<br>无序消费，活跃线程数=20。</p><p>topic 的 messageQueue 是可以动态变更的，并且消费者无需重启就可以实现。</p><p>consumer 换新的，那么 topic 就需要换新的，否则会重头开始消费。所以如果消费者不支持重复消费逻辑，那就会有问题。<br>这里面有些理论知识，和字面意思不一样<br><a href="https://blog.csdn.net/a417930422/article/details/83585397">https://blog.csdn.net/a417930422/article/details/83585397</a></p><p>2、单个消费者，双消费者的线程数是怎样的。（并不会互相影响）<br>无序消费者：每个消费者单独的 20 线程数进行处理。不共用线程数。但是从线程名字无法区分出来。</p><p>有序消费者：每个消费者单独的 messageQueue 线程数进行处理。不共用线程数。但是从线程名字无法区分出来。</p><p>3、</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>xxl-job本地开发环境调用</title>
      <link href="posts/86401e8b.html"/>
      <url>posts/86401e8b.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.xuxueli.com/xxl-job/#6.2%20%E6%89%A7%E8%A1%8C%E5%99%A8%20RESTful%20API">https://www.xuxueli.com/xxl-job/#6.2%20%E6%89%A7%E8%A1%8C%E5%99%A8%20RESTful%20API</a><br><a href="https://www.xuxueli.com/xxl-job/#c%E3%80%81%E8%A7%A6%E5%8F%91%E4%BB%BB%E5%8A%A1">https://www.xuxueli.com/xxl-job/#c%E3%80%81%E8%A7%A6%E5%8F%91%E4%BB%BB%E5%8A%A1</a></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">"develop"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{</span>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.localAddress}"</span><span class="token punctuation">)</span>  <span class="token class-name">String</span> localAddress<span class="token punctuation">;</span>  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.accessToken}"</span><span class="token punctuation">)</span>  <span class="token class-name">String</span> accessToken<span class="token punctuation">;</span>  <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"手动触发任务"</span><span class="token punctuation">)</span>  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/run"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"adminClientAddressUrl:{},accessToken:{}"</span><span class="token punctuation">,</span> localAddress<span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ExecutorBiz</span> executorBiz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExecutorBizClient</span><span class="token punctuation">(</span>localAddress<span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ReturnT</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> retval <span class="token operator">=</span> executorBiz<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token function">getTriggerParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"retval:{}"</span><span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">obj2String</span><span class="token punctuation">(</span>retval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 200 表示正常、其他失败</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>retval<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token string">"success"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token string">"fail"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">private</span> <span class="token class-name">TriggerParam</span> <span class="token function">getTriggerParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">TriggerParam</span> triggerParam <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TriggerParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 任务标识</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setExecutorHandler</span><span class="token punctuation">(</span><span class="token string">"WxWorkUserChatDataJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 任务参数</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setExecutorParams</span><span class="token punctuation">(</span><span class="token string">"手动触发任务"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 任务阻塞策略，可选值参考 com.xxl.job.core.enums.ExecutorBlockStrategyEnum</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setExecutorBlockStrategy</span><span class="token punctuation">(</span><span class="token class-name">ExecutorBlockStrategyEnum</span><span class="token punctuation">.</span>COVER_EARLY<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 任务模式，可选值参考 com.xxl.job.core.glue.GlueTypeEnum</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setGlueType</span><span class="token punctuation">(</span><span class="token class-name">GlueTypeEnum</span><span class="token punctuation">.</span>BEAN<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// GLUE脚本代码</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setGlueSource</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// GLUE脚本更新时间，用于判定脚本是否变更以及是否需要刷新</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setGlueUpdatetime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 本次调度日志ID</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setLogId</span><span class="token punctuation">(</span>triggerParam<span class="token punctuation">.</span><span class="token function">getJobId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 本次调度日志时间</span>    triggerParam<span class="token punctuation">.</span><span class="token function">setLogDateTime</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> triggerParam<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>xxl-job添加traceId</title>
      <link href="posts/5152b423.html"/>
      <url>posts/5152b423.html</url>
      
        <content type="html"><![CDATA[<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Aspect</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Slf4j</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XXLJobHandlerAspect</span> <span class="token punctuation">{</span>  <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"execution(public * cn..*.execute(String))"</span><span class="token punctuation">)</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforMethod</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//往slf4j的MDC中添加traceId</span>    MDC<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">CharacterConstant</span><span class="token punctuation">.</span>REQUEST_ID_HEADER<span class="token punctuation">,</span>        UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"method :{} 修改X-Request-Id"</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>oss+cdn</title>
      <link href="posts/456fb9b8.html"/>
      <url>posts/456fb9b8.html</url>
      
        <content type="html"><![CDATA[<p>You don’t have permission to access the URL on this server.<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1620873168028-ab58e815-0975-4c45-8a6f-f1861ab4545f.png#align=left&amp;display=inline&amp;height=165&amp;id=L8NxH&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=330&amp;originWidth=970&amp;size=28990&amp;status=done&amp;style=none&amp;width=485" alt="image.png"><br>You are forbidden to list buckets<br><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1620873142063-91636e80-bc27-4162-beba-7a82169462b7.png#align=left&amp;display=inline&amp;height=340&amp;id=xOOeD&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=680&amp;originWidth=1233&amp;size=109049&amp;status=done&amp;style=none&amp;width=617" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/12993248/1620873023060-b0495ee7-d18f-4fe8-a4b1-11ca98fcbcce.png#align=left&amp;display=inline&amp;height=316&amp;id=IlV6z&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=631&amp;originWidth=1258&amp;size=93858&amp;status=done&amp;style=none&amp;width=629" alt="image.png"></p><p>^/$ /index.html</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="posts/d87f7e0c.html"/>
      <url>posts/d87f7e0c.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>主题备选</title>
      <link href="posts/bbb68bef.html"/>
      <url>posts/bbb68bef.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/zz_cheng/article/details/116329833">https://blog.csdn.net/zz_cheng/article/details/116329833</a><br>hexo-theme-melody<br><a href="https://github.com/hongweifuture/hexo-theme-halo">https://github.com/hongweifuture/hexo-theme-halo</a><br><a href="https://sunhwee.com/posts/6e8839eb.html">https://sunhwee.com/posts/6e8839eb.html</a><br><a href="https://lovelijunyi.gitee.io/posts/b8ec.html">https://lovelijunyi.gitee.io/posts/b8ec.html</a><br><a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md">https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md</a><br><a href="https://blinkfox.github.io/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/">https://blinkfox.github.io/2018/09/28/qian-duan/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/</a></p><p>Hexo：语雀云端写作，Github Actions 持续集成<br><a href="https://blog.csdn.net/z_johnny/article/details/104629805/">https://blog.csdn.net/z_johnny/article/details/104629805/</a></p><p><a href="https://www.zhwei.cn/github-actions-deploy-hexo-api/#toc-heading-7">https://www.zhwei.cn/github-actions-deploy-hexo-api/#toc-heading-7</a></p><p>logo 设计<br><a href="https://www.zhihu.com/question/20423593">https://www.zhihu.com/question/20423593</a></p><p>真正的 log 设计<br><a href="https://www.fotor.com.cn/app.html#/design/95c3c710-b1fd-11eb-9f66-2b4dc6c7b4ee/upload">https://www.fotor.com.cn/app.html#/design/95c3c710-b1fd-11eb-9f66-2b4dc6c7b4ee/</a>upload<br><a href="https://www.pngtosvg.com/">https://www.pngtosvg.com/</a></p><p>阿里云的函数计算</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> logging<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timezone<span class="token keyword">import</span> jsoninfo <span class="token operator">=</span> <span class="token string">b'fail!\n'</span><span class="token keyword">def</span> <span class="token function">handler</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        request_body_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'CONTENT_LENGTH'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> <span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span><span class="token punctuation">:</span>        request_body_size <span class="token operator">=</span> <span class="token number">0</span>    request_body <span class="token operator">=</span> environ<span class="token punctuation">[</span><span class="token string">'wsgi.input'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span>request_body_size<span class="token punctuation">)</span>    title <span class="token operator">=</span> <span class="token string">""</span>    action_type <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>request_body<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>        body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>request_body<span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        title <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>        action_type <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'action_type'</span><span class="token punctuation">]</span>    SHA_TZ <span class="token operator">=</span> timezone<span class="token punctuation">(</span>      timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      name<span class="token operator">=</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span>    utc_now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>tzinfo<span class="token operator">=</span>timezone<span class="token punctuation">.</span>utc<span class="token punctuation">)</span>    beijing_now <span class="token operator">=</span> utc_now<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>SHA_TZ<span class="token punctuation">)</span>    now <span class="token operator">=</span> beijing_now<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"https://api.github.com/repos/waters321/waters321-blog/dispatches"</span><span class="token punctuation">,</span>    json <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"event_type"</span><span class="token punctuation">:</span> <span class="token string">"yuque_auto_build"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/vnd.github.everest-preview+json'</span><span class="token punctuation">,</span>        <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'token xxxxxxxx'</span><span class="token punctuation">,</span>        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">204</span><span class="token punctuation">:</span>        info <span class="token operator">=</span> <span class="token string">b'success!\n'</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://wxpusher.zjiecode.com/api/send/message"</span><span class="token punctuation">,</span>    json <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">"appToken"</span><span class="token punctuation">:</span> <span class="token string">"AT_eSCPxuQTpSJDsYaQY8xL5r5XPdj22tvW"</span><span class="token punctuation">,</span>        <span class="token string">"content"</span><span class="token punctuation">:</span> now <span class="token operator">+</span> "语雀 to hexo 触发部署<span class="token string">" + title + "</span><span class="token string">" + action_type + "</span><span class="token string">" + str(info, encoding = "</span>utf<span class="token operator">-</span><span class="token number">8</span>"<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"summary"</span><span class="token punctuation">:</span> now <span class="token operator">+</span> "语雀 to hexo 触发部署<span class="token string">" + title + "</span>     <span class="token string">" + action_type + "</span><span class="token string">" + str(info, encoding = "</span>utf<span class="token operator">-</span><span class="token number">8</span>"<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"contentType"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token string">"uids"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token string">"UID_ZBbeDhU30f0zikY3ILqRDxHcDjD8"</span>        <span class="token punctuation">]</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>blog相关</title>
      <link href="posts/5f1c9ca.html"/>
      <url>posts/5f1c9ca.html</url>
      
        <content type="html"><![CDATA[<p>adfasdf</p><p>44444413123998989812312312312313123</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hive</title>
      <link href="posts/dc6dbbf8.html"/>
      <url>posts/dc6dbbf8.html</url>
      
        <content type="html"><![CDATA[<p>wget <a href="http://mirrors.tuna.tsinghua.edu.cn/apache/hive/hive-3.1.2/apache-hive-3.1.2-bin.tar.gz">http://mirrors.tuna.tsinghua.edu.cn/apache/hive/hive-3.1.2/apache-hive-3.1.2-bin.tar.gz</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/data/bigdata/apache-hive-3.1.2-bin<span class="token assign-left variable">HIVE_CONF_DIR</span><span class="token operator">=</span>/data/bigdata/apache-hive-3.1.2-bin/conf<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HIVE_HOME</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>hive-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.warehouse.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/hive/warehouse<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.exec.stagingdir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/hive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>password<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionDriverName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.mysql.cj.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hive.metastore.schema.verification<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>hive-env.sh</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span>  <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/data/bigdata/hadoop-3.2.2<span class="token builtin class-name">export</span>  <span class="token assign-left variable">HIVE_CONF_DIR</span><span class="token operator">=</span>/data/bigdata/apache-hive-3.1.2-bin/conf<span class="token builtin class-name">export</span>  <span class="token assign-left variable">HIVE_AUX_JARS_PATH</span><span class="token operator">=</span>/data/bigdata/apache-hive-3.1.2-bin/lib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>cd lib<br>wget <a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.24/mysql-connector-java-8.0.24.jar">https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.24/mysql-connector-java-8.0.24.jar</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">schematool  -initSchema -dbType mysql<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>${system:java.io.tmpdir}<br>${system:user.name}<br>需要</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> t1<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">-- hadoop fs -ls /data/hive/warehouse/test.db/t1</span><span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> t2_oss <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span> location <span class="token string">'oss://staging-beijing-private/hadoop-test/t2_oss'</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> t3_oss <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span> location <span class="token string">'oss://staging-beijing-private/hadoop-test/t3_oss'</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tt_oss <span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name string<span class="token punctuation">)</span> location <span class="token string">'oss://staging-beijing-private/hadoop-test/tt_oss'</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t2_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t3_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t3_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t3_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t3_oss <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'zhangsan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>FAQ:<br>(1) java.lang.NoSuchMethodError: com.google.common.base.Preconditions.checkArgument<br><a href="https://blog.csdn.net/GQB1226/article/details/102555820">https://blog.csdn.net/GQB1226/article/details/102555820</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>hadoop v3</title>
      <link href="posts/150dfbc8.html"/>
      <url>posts/150dfbc8.html</url>
      
        <content type="html"><![CDATA[<p>wget <a href="http://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz">http://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/common/hadoop-3.2.2/hadoop-3.2.2.tar.gz</a></p><p>/etc/profile</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/data/bigdata/hadoop-3.2.2<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>cd etc/hadoop/</p><p>vim core-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://staging-k8s-uba:9001/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/bigdata/hadoop-temp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>vim hadoop-env.sh</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/webuser/jdk1.8.0_211<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>hdfs-site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 配置HDFS副本的数量 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.support.append<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">bin/hadoop namenode -format<span class="token builtin class-name">cd</span> sbin./start-dfs.shhadoop fs -ls /hadoop fs -mkdir /waters321/aahadoop fs -ls /waters321<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>/</p><p>支持阿里云 OSS</p><p>core_site.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.oss.endpoint<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>YourEndpoint<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Aliyun OSS endpoint to connect to. <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.oss.accessKeyId<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>YourAccessKeyId<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Aliyun access key ID<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.oss.accessKeySecret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>YourAccessKeySecret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Aliyun access key secret<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.oss.impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.fs.aliyun.oss.AliyunOSSFileSystem<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.oss.buffer.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/tmp/oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>etc/hadoop/hadoop-env.sh</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_OPTIONAL_TOOLS</span><span class="token operator">=</span><span class="token string">"hadoop-aliyun"</span><span class="token comment"># 测试读</span>hadoop fs -ls oss://staging-beijing-private/<span class="token comment"># 测试写</span>hadoop fs -mkdir oss://staging-beijing-private/hadoop-test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://developer.aliyun.com/article/767222">https://developer.aliyun.com/article/767222</a><br><a href="https://github.com/aliyun/aliyun-emapreduce-datasources/blob/main/docs/jindofs_sdk_how_to.md">https://github.com/aliyun/aliyun-emapreduce-datasources/blob/main/docs/jindofs_sdk_how_to.md</a><br>拥抱云原生，Fluid 结合 JindoFS ：阿里云 OSS 加速利器<br><a href="https://developer.aliyun.com/article/781802?spm=a2c6h.12873581.0.dArticle781802.207547b4SCy3vG">https://developer.aliyun.com/article/781802?spm=a2c6h.12873581.0.dArticle781802.207547b4SCy3vG</a></p><p><a href="http://47.95.211.178:9870/dfshealth.html#tab-overview">http://47.95.211.178:9870/dfshealth.html#tab-overview</a></p><p>FAQ:</p><p>(1) appendToFile: Append is not supported!<br>OSS 不支持的。<br>(2)版本对应关系</p><p><a href="http://hbase.apache.org/book.html#java">http://hbase.apache.org/book.html#java</a> hadoop vs hbase<br><a href="http://hive.apache.org/downloads.html">http://hive.apache.org/downloads.html</a> hadoop vs hive</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>helm v2 -&gt; v3</title>
      <link href="posts/9261e9ce.html"/>
      <url>posts/9261e9ce.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://zhuanlan.zhihu.com/p/148914920">https://zhuanlan.zhihu.com/p/148914920</a><br><a href="https://www.jianshu.com/p/08f2a82f0756">https://www.jianshu.com/p/08f2a82f0756</a></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">wget</span> https://get.helm.sh/helm-v3.5.4-linux-amd64.tar.gz -O /tmp/helm-v3.5.4-linux-amd64.tar.gz<span class="token function">tar</span> xf /tmp/helm-v3.5.4-linux-amd64.tar.gz<span class="token builtin class-name">cd</span> /tmp/linux-amd64<span class="token function">mv</span> helm /usr/local/bin/helm3helm3 plugin <span class="token function">install</span> https://github.com/helm/helm-2to3helm3 plugin listhelm3 2to3 move confighelm3 repo listhelm3 repo updatehelm3 plugin list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ververica/ververica-platform</title>
      <link href="posts/9bd49529.html"/>
      <url>posts/9bd49529.html</url>
      
        <content type="html"><![CDATA[<p>需要是 helm3 才行。</p><p><a href="https://docs.ververica.com/installation/helm/index.html">https://docs.ververica.com/installation/helm/index.html</a></p><p>helm3 repo add ververica <a href="https://charts.ververica.com/">https://charts.ververica.com</a></p><p>helm3 fetch –version 5.0.2 ververica/ververica-platform</p><p>helm3 search repo -l ververica/ververica-platform</p><p>helm3 inspect values –version 5.0.2 ververica/ververica-platform</p><p>helm3 inspect values –version 5.0.2 ververica/ververica-platform &gt; values.yaml</p><p>helm3 install vvp ververica/ververica-platform ****<br>&nbsp; &nbsp; –namespace flink ****<br>&nbsp; &nbsp; –values values.yaml ****<br>&nbsp; &nbsp; –version 5.0.2</p><p>（1）存储卷的问题<br>（2）权限的问题 chmod -R 0777 /mnt/flink/</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
